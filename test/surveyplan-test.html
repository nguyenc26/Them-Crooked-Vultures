<!DOCTYPE html>

<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.4.1.js"
        integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU=" crossorigin="anonymous"></script>
</head>

<body>
    <div class="row">
        {{#if user}}
        <h5>Welcome back {{{user}}} !</h5>
        <a class="btn btn-info btn-lg" class="glyphicon glyphicon-log-ou" href="/" style=" width:auto;">log out</a>
        {{else}}
        <p>Please <a href='/'>Log In</a></p>
        {{/if}}

    </div>

    <div class="container">
        <form action="/controllers/profile-controller" method="post">
            <input type="hidden" type="hidden" name="username" value={{{user}}}>
            <button class="btn waves-effect waves-light" type="submit">Profile </button>
        </form>


        <div class="row">
            <div class="col s12 center">
                <h1 class="center grey-text">Trip Planner!</h1>
                <p class="center grey-text ">Now that we know where you are going - build out the details here!</p>
            </div>
        </div>
    </div>

    <!-- Float this container Left -->
    <div class="container" style="position: fixed; bottom: 50%; left: 10%; top: 20%;">
        <div class="row col s3">
            <div class="card col s3 left">
                <div class="card-image waves-effect waves-block waves-light">
                    <img class="activator" id="destination-image"
                        src="https://media.gettyimages.com/photos/eiffel-tower-in-paris-france-picture-id924894324?s=612x612">
                </div>
                <div class="card-content">
                    <span class="card-title activator grey-text text-darken-4">See Details Here<i
                            class="material-icons right">more_vert</i></span>
                    <p><i>trip name goes here</i></p>
                </div>
                <div class="card-reveal">
                    <span class="card-title grey-text text-darken-4"><i>trip name goes here</i><i
                            class="material-icons right">close</i></span>

                    <!-- Have these fields editable / updateable -->
                    <p><b>Origin:</b> Minneapolis, MN</p>
                    <p><b>Destination:</b> Paris, France</p>
                    <p><b>Group Size:</b> 5</p>
                    <p><b>Begin Date:</b> 11/11/19</p>
                    <p><b>End Date:</b> 11/20/19</p>
                </div>
            </div>
        </div>
    </div>



    <div class="container">
        <div class="row">
            <div class="col s9 right">
                <div class="divider"></div>
                <div class="row">
                    <div class="center">
                        <h5 class="col-s5 offset-s7">Flights</h5>

                    </div>
                </div>

                <div class="divider"></div>

                <div class="row">
                    <div class="center">
                        <h5 class="col-s5 offset-s7">Hotels</h5>
                    </div>
                </div>

                <div class="divider"></div>

                <div class="row">
                    <div class="center">
                        <h5 class="col-s5 offset-s7">Food</h5>
                    </div>
                </div>

                <div class="divider"></div>

                <div class="row">
                    <div class="center">
                        <h5 class="col-s5 offset-s7">Events</h5>
                        <div class="input-field col s12">
                            <input value="Australia" id="event_name2" type="text" class="validate">
                            <label class="active" for="event_name2">Search Events by Location</label>
                            <a class="waves-effect waves-light btn">button</a>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="card col s4">
                        <div class="card-image waves-effect waves-block waves-light">
                            <img class="activator" id="event-image">
                        </div>
                        <div class="card-content">
                            <span class="card-title activator grey-text text-darken-4" id="event_name">Card Title<i
                                    class="material-icons right">more_vert</i></span>
                            <p><a href="#">This is a link</a></p>
                        </div>
                        <div class="card-reveal">
                            <span class="card-title grey-text text-darken-4" id="event_name2">Card Title<i
                                    class="material-icons right">close</i></span>
                            <p style="font-size: 10pt;" id="venue_name"></p>
                            <p style="font-size: 10pt;" id="venue_address"></p>
                            <p style="font-size: 10pt;" id="location_name"></p>
                            <p style="font-size: 10pt;" id="start_time"></p>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="center">
                        <div class="input-field col s12">
                            <input value="Shawn Mendes" id="artist_name2" type="text" class="validate">
                            <label class="active" for="artist_name2">Search for performers</label>
                            <a class="waves-effect waves-light btn">button</a>
                        </div>
                    </div>
                </div>

                <div class="carousel" id="add-artists">
                    <a class="carousel-item" href="#one!"><img src="https://lorempixel.com/250/250/nature/1"></a>
                    <a class="carousel-item" href="#two!"><img src="https://lorempixel.com/250/250/nature/2"></a>
                    <a class="carousel-item" href="#three!"><img src="https://lorempixel.com/250/250/nature/3"></a>
                    <a class="carousel-item" href="#four!"><img src="https://lorempixel.com/250/250/nature/4"></a>
                    <a class="carousel-item" href="#five!"><img src="https://lorempixel.com/250/250/nature/5"></a>

                    <!-- artistDiv -->
                    <div class="carousel-item">
                        <!-- child1 -->
                        <div class="card col s12">
                            <!-- child2 -->
                            <div class="card-image waves-effect waves-block waves-light">
                                <img class="activator" id="" src="https://lorempixel.com/250/250/nature/5">
                            </div>
                            <!-- child3 -->
                            <div class="card-content">
                                <span class="card-title activator grey-text text-darken-4" id="artist_name">Card Title<i
                                        class="material-icons right">more_vert</i></span>
                                <p><a href="#">This is a link</a></p>
                            </div>
                            <!-- child4 -->
                            <div class="card-reveal">
                                <span class="card-title grey-text text-darken-4" id="event_name2">Card Title<i
                                        class="material-icons right">close</i></span>
                                <p style="font-size: 10pt;" id="artist_venue"></p>
                                <p style="font-size: 10pt;" id="artist_venue_address"></p>
                                <p style="font-size: 10pt;" id="artist_location_name"></p>
                                <p style="font-size: 10pt;" id="artist_start_time"></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row"></div>

            <div class="divider"></div>

            <div class="row">
                <div class="center">
                    <h5 class="col-s5 offset-s7">Site Seeing</h5>
                </div>
            </div>
        </div>
    </div>
    </div>

    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>


    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <script>
        $(document).ready(function () {
            $('.carousel').carousel();
            $(document).on("click", ".btn", function () {
                var parser, xmlDoc;
                var singer = $("#event_name2").val().trim();
                // console.log(singer);

                var queryURL1 = "https://pixabay.com/api/?key=14031716-ee5fc1d1564bb90e3420570a5&q=" +
                    singer + "&image_type=photo&safesearch=true&order=popular&category=places&totalHits=1&fullHDURL";
                var queryURL2 = "https://community-eventful.p.rapidapi.com/events/search?keywords=" + singer + "&app_key=q2Qg27LVgj8fNJsB";
                var settings = {
                    "async": true,
                    "crossDomain": true,
                    "url": queryURL2,
                    // "url": "https://community-eventful.p.rapidapi.com/events/search?keywords=shawn%20mendes&app_key=q2Qg27LVgj8fNJsB",
                    "method": "GET",
                    "headers": {
                        "x-rapidapi-host": "community-eventful.p.rapidapi.com",
                        "x-rapidapi-key": "69ce8a3b37msh84834038fac1addp1d1a99jsn88d57080377b"
                    }
                }

                $.ajax({
                    url: queryURL1,
                    method: "GET"
                }).then(function (resp1) {
                    $.ajax(settings)
                        .then(function (resp2) {
                            var results = resp1;
                            console.log(resp1);
                            var photo = results.hits[0].largeImageURL;

                            var destinationImage = $("#event-image");
                            destinationImage.attr("src", photo);
                            // destinationImage.attr("style", "height: 250px; width:250px;")

                            console.log(resp2);
                            console.log(resp2.childNodes[0].nodeValue);
                            console.log(resp2.getElementsByTagName("name")[0].childNodes[0].nodeValue);
                            console.log(resp2.getElementsByTagName("venue_name")[0].childNodes[0].nodeValue);
                            console.log(resp2.getElementsByTagName("venue_address")[0].childNodes[0].nodeValue);
                            console.log(resp2.getElementsByTagName("city_name")[0].childNodes[0].nodeValue);
                            console.log(resp2.getElementsByTagName("country_name")[0].childNodes[0].nodeValue);
                            console.log(resp2.getElementsByTagName("start_time")[0].childNodes[0].nodeValue);
                            // console.log(resp2.getElementsByTagName("stop_time")[0].childNodes[0].nodeValue);

                            document.getElementById("event_name").innerHTML =
                                resp2.getElementsByTagName("name")[0].childNodes[0].nodeValue;

                            document.getElementById("event_name2").innerHTML = "Perfomer: " +
                                resp2.getElementsByTagName("name")[0].childNodes[0].nodeValue;

                            document.getElementById("venue_name").innerHTML = "Venue: " +
                                resp2.getElementsByTagName("venue_name")[0].childNodes[0].nodeValue;

                            document.getElementById("venue_address").innerHTML = "Venue Address: " +
                                resp2.getElementsByTagName("venue_address")[0].childNodes[0].nodeValue + " " + resp2.getElementsByTagName("city_name")[0].childNodes[0].nodeValue + ", " + resp2.getElementsByTagName("country_name")[0].childNodes[0].nodeValue;;

                            document.getElementById("start_time").innerHTML = "Date & Time: " +
                                resp2.getElementsByTagName("start_time")[0].childNodes[0].nodeValue;
                        });
                });

                // this is the call for the carousel
                var thingToLookUp = $("#artist_name2").val().trim();
                var eventThing = $("#event_name2").val().trim();

                var queryURL3 = "https://rest.bandsintown.com/artists/" + thingToLookUp + "/events?app_id=codingbootcamp"

                $.ajax({
                    url: queryURL3,
                    method: "GET"
                }).then(function (resp3) {

                    var results = resp3;
                    console.log(results);
                    // var countryLoc = results[1].venue.country;
                    // console.log(countryLoc);
                    var displayShows = [];
                    for (shows in results) {
                        if (results[shows].venue.country === eventThing) {
                            displayShows.push(results[shows]);
                        }
                    }
                    console.log(displayShows);
                    console.log(displayShows[1].offers[1].url);

                    // for (items in displayShows) 
                    for (var i = 0; i < displayShows.length; i++) {
                        // console.log(displayShows[i]);
                        var artistDiv = $("<div>").attr("class", "carousel-item");
                        var child1 = $("<div>").attr("class", "card col s12");
                        // console.log(child1);

                        var child2 = $("<div>").attr("class", "card-image waves-effect waves-block waves-light");
                        var artistImg = $("<img>").attr("class", "activator");
                        artistImg.attr("src", "https://images-na.ssl-images-amazon.com/images/I/81B1F0TMyBL._SY355_.jpg");
                        child2.append(artistImg);


                        var child3 = $("<div>").attr("class", "card-content");
                        var spanItem1 = $("<span>").attr("class", "card-title activator grey-text text-darken-4");
                        var imageContainer1 = $("<i>").text("more_vert").attr("class", "material-icons right");
                        spanItem1.append(imageContainer1);

                        var para1 = $("<p>").append("<a href='" + displayShows[i].offers[0].url + "'>Checkout Tickets</a>");
                        var para2 = $("<p>").append("<a href='" + displayShows[i].offers[1].url + "'>Checkout VIP Tickets</a>");
                        // var link1 = $("<a>").text("Checkout Tickets").attr("href", displayShows[items].offers[1].url);
                        // var link2 = $("<a>").text("Checkout VIP Tickets").attr("href", displayShows[items].offers[2].url);
                        child3.append(spanItem1);
                        child3.append(para1);
                        child3.append(para2);

                        var child4 = $("<div>").attr("class", "card-reveal");
                        var spanItem2 = $("<span>").attr("class", "card-title grey-text text-darken-4");
                        var imageContainer2 = $("<i>").text("close").attr("class", "material-icons right");
                        spanItem2.append(imageContainer2);
                        var venueForArtist = $("<p>").text("Venue: " + displayShows[i].venue.name);
                        // address is in long / lat - need to convet
                        // var venueAddressForArtist = $("<p>").text("Address " + displayShows[i].venue.address);
                        var locationForArtist = $("<p>").text("City: " + displayShows[i].venue.city + ", " + displayShows[i].venue.country);
                        var timeOfPerformance = $("<p>").text("Time: " + displayShows[i].datetime);
                        child4.append(spanItem2);
                        child4.append(venueForArtist);
                        child4.append(locationForArtist);
                        child4.append(timeOfPerformance);

                        child1.append(child2);
                        child1.append(child3);
                        child1.append(child4);

                        // console.log(child1);
                        artistDiv.append(child1);
                        console.log(artistDiv);
                        $("#add-artists").append(artistDiv);
                    }


                });
            });
        })

    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

</body>

</html>