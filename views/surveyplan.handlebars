<div class="nav-wrapper black" style="color:antiquewhite;">
    {{#if user}}
    <h5>Welcome back {{{user}}}!</h5>
    <br />
    <div class="row " style="position:fixed;right:20px;top:10px;z-index:5">
        <a class="btn btn-info btn-lg" class="glyphicon glyphicon-log-ou" href="/" style=" width:auto;">log out</a>
    </div>
    <div class="row " style="position:fixed;right:150px;top:10px;z-index:5;">
        <form action="/controllers/profile-controller" method="post">
            <input type="hidden" type="hidden" name="username" value={{{user}}}>

            <button class="btn btn-info btn-lg" class="glyphicon glyphicon-log-ou" type="submit"
                style=" width:auto;">Profile </button>
        </form>
    </div>
</div>
{{else}}
<h4>
    <p>Please <a href='/'>Log In</a></p>
</h4>
{{/if}}
</div>

<div class="container">
    <div class="row">
        <div class="col s12 center">
            <h1 class="center grey-text trip-planner">Day-Dreamer!</h1>
            <p class="center grey-text ">Now that we know where you are going - build out the details here!</p>
        </div>
    </div>
</div>

<!--Flights parallax-->
<div id="index-banner" class="parallax-container" style="height: 200px;">
    <div class="section no-pad-bot">
        <h5 class="col-s5 offset-s7 parallaxText">Flights</h5>
    </div>
    <div class="parallax"><img src="/img/airplane2.jpg" alt="airplane image">
    </div>
</div>
<div class="container">
    <div class="row">
        <div class="divider"></div>
        <br>
        <div class="row">
            <div data-skyscanner-widget="SearchWidget"></div>
        </div>
    </div>
</div>

<!--Hotels parallax-->
<div id="index-banner" class="parallax-container" style="height: 200px;">
    <div class="section no-pad-bot">
        <h5 class="col-s5 offset-s7 parallaxText">Hotels</h5>
    </div>
    <div class="parallax"><img src="/img/hotel.jpg" alt="hotel hallway image">
    </div>
</div>
<div class="container">
    <div class="divider"></div>
    <br>
    <div class="row center">
        <a class="btn teal accent-1 black-text" href=''>Search Hotels</a>
    </div>
</div>

<!--Food parallax-->
<div id="index-banner" class="parallax-container" style="height: 200px;">
    <div class="section no-pad-bot">
        <h5 class="col-s5 offset-s7 parallaxText">Food</h5>
    </div>
    <div class="parallax"><img src="/img/food.jpg" alt="food table image">
    </div>
</div>
<div class="container">
    <div class="divider"></div>
    <br>
    <div class="row center">
        <div class="w3-third w3-section">
            <div id="overflowTest" class="w3-card-4">
                <div class="card col s12 left">
                    <div class="card-image waves-effect waves-block waves-light">
                        <img class="activator" id="destination-image"
                            src="https://notablelife.com/media/2015/07/resto.jpg">
                    </div>
                    <div class="card-content">
                        <span class="card-title activator grey-text text-darken-4">Find the best Restaurants<i
                                class="material-icons right">more_vert</i></span>
                        <input id="destination" type="hidden" destination="username" value={{{destination}}}>
                        <p><i>trip name goes here </i></p>
                    </div>
                    <div class="card-reveal">
                        <div class="message col-md-12"></div>
                        <span class="card-title grey-text "><i>Close</i>
                        </span>
                        <div id="overflowTest" class="jumbotron jumbotron-billboard text-center">
                            <div class="container pt">
                                <div class="mt-5 text-color">
                                    <h4>Find the best Restaurants</h4>
                                </div>
                                <div class="col-xs-6 pl-0 pr-0">
                                    <input id="getText" type="text" class="form-control"
                                        placeholder="Enter Restaurant Type">
                                </div>
                                <button id="getMessage" class="btn btn-success col-xs-2">Search</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!--Events parallax-->
<div id="index-banner" class="parallax-container" style="height: 200px;">
    <div class="section no-pad-bot">
        <h5 class="col-s5 offset-s7 parallaxText">Events</h5>
    </div>
    <div class="parallax"><img src="/img/celebration.jpg" alt="fireworks image">
    </div>
</div>
<div class="container">
    <div class="divider"></div>
    <br>
    <div class="row">
        <div class="center">
            <div class="input-field col s12">
                <input value="Shawn Mendes" id="artist_name2" type="text" class="validate">
                <label class="active" for="artist_name2">Search for performers</label>
                <a class="waves-effect waves-light btn">button</a>
            </div>
        </div>
    </div>

    <div class="carousel" id="add-artists">
        <a class="carousel-item" href="#one!"><img src="https://lorempixel.com/250/250/nature/1"></a>
        <a class="carousel-item" href="#two!"><img src="https://lorempixel.com/250/250/nature/2"></a>
        <a class="carousel-item" href="#three!"><img src="https://lorempixel.com/250/250/nature/3"></a>
        <a class="carousel-item" href="#four!"><img src="https://lorempixel.com/250/250/nature/4"></a>
        <a class="carousel-item" href="#five!"><img src="https://lorempixel.com/250/250/nature/5"></a>

        <!-- artistDiv -->
        <div class="carousel-item">
            <!-- child1 -->
            <div class="card col s12">
                <!-- child2 -->
                <div class="card-image waves-effect waves-block waves-light">
                    <img class="activator" id="" src="https://lorempixel.com/250/250/nature/5">
                </div>
                <!-- child3 -->
                <div class="card-content">
                    <span class="card-title activator grey-text text-darken-4" id="artist_name">Card Title<i
                            class="material-icons right">more_vert</i></span>
                    <p><a href="#">This is a link</a></p>
                </div>
                <!-- child4 -->
                <div class="card-reveal">
                    <span class="card-title grey-text text-darken-4" id="event_name2">Card Title<i
                            class="material-icons right">close</i></span>
                    <p style="font-size: 10pt;" id="artist_venue"></p>
                    <p style="font-size: 10pt;" id="artist_venue_address"></p>
                    <p style="font-size: 10pt;" id="artist_location_name"></p>
                    <p style="font-size: 10pt;" id="artist_start_time"></p>
                </div>
            </div>
        </div>
    </div>
</div>
</div>

<script>
    $(document).ready(function () {
        $("#getMessage").on("click", function () {
            var valueSearchBox = $('#getText').val()
            if (valueSearchBox === "") {
                return;
            }
            select();
        });
        //--------------------------------------------------SEARCH BY CITY-----------------------------------------
        function select() {
            var address = $('#destination').val();
            var valueSearchBox = $('#getText').val()
            var searchCity = "&q=" + valueSearchBox;
            var settings = {
                "async": true,
                "crossDomain": true,
                "url": "https://developers.zomato.com/api/v2.1/search?entity_id=" + address + "&entity_type=city" + searchCity + "&count=20",
                "method": "GET",
                "headers": {
                    "user-key": "967e2e08ce22588b1668ae3b432bf765",
                    'Content-Type': 'application/x-www-form-urlencoded'
                }
            }

            $.getJSON(settings, function (data) {

                data = data.restaurants;
                var html = "";

                $.each(data, function (index, value) {

                    var x = data[index];
                    $.each(x, function (index, value) {
                        var location = x.restaurant.location;
                        var userRating = x.restaurant.user_rating;
                        html += "<div class='data img-rounded'>";
                        html += "<div class='rating'>";
                        html += "<span title='" + userRating.rating_text + "'><p style='color:white;background-color:#" + userRating.rating_color + ";border-radius:4px;border:none;padding:2px 10px 2px 10px;text-align: center;text-decoration:none;display:inline-block;font-size:16px;float:right;'><strong>" + userRating.aggregate_rating + "</strong></p></span><br>";
                        html += "  <strong class='text-info'>" + userRating.votes + " votes</strong>";
                        html += "</div>";
                        html += "<img class='resimg img-rounded' src=" + value.thumb + " alt='Restaurant Image' height='185' width='185'>";
                        html += "<a href=" + value.url + " target='_blank' class='action_link'><h2 style='color:red;'><strong>" + value.name + "</strong></h2></a>";
                        html += "  <strong class='text-primary'>" + location.locality + "</strong><br>";
                        html += "  <h6 style='color:grey;'><strong>" + location.address + "</strong></h6><hr>";
                        html += "  <strong>CUISINES</strong>: " + value.cuisines + "<br>";
                        html += "  <strong>COST FOR TWO</strong>: " + value.currency + value.average_cost_for_two + "<br>";
                        html += "</div><br>";
                    });
                });
                $(".message").html(html);
            });

        }
        //--------------------------------------------------------------------------------------------------------
        $("#select_id").change(function () {
            select();
        });

        $('.carousel').carousel();
        $(document).on("click", ".btn", function () {
            var parser, xmlDoc;
            var singer = $("#event_name2").val().trim();
            // console.log(singer);

            var queryURL1 = "https://pixabay.com/api/?key=14031716-ee5fc1d1564bb90e3420570a5&q=" +
                singer + "&image_type=photo&safesearch=true&order=popular&category=places&totalHits=1&fullHDURL";
            var queryURL2 = "https://community-eventful.p.rapidapi.com/events/search?keywords=" + singer + "&app_key=q2Qg27LVgj8fNJsB";
            var settings = {
                "async": true,
                "crossDomain": true,
                "url": queryURL2,
                // "url": "https://community-eventful.p.rapidapi.com/events/search?keywords=shawn%20mendes&app_key=q2Qg27LVgj8fNJsB",
                "method": "GET",
                "headers": {
                    "x-rapidapi-host": "community-eventful.p.rapidapi.com",
                    "x-rapidapi-key": "69ce8a3b37msh84834038fac1addp1d1a99jsn88d57080377b"
                }
            }

            $.ajax({
                url: queryURL1,
                method: "GET"
            }).then(function (resp1) {
                $.ajax(settings)
                    .then(function (resp2) {
                        var results = resp1;
                        console.log(resp1);
                        var photo = results.hits[0].largeImageURL;

                        var destinationImage = $("#event-image");
                        destinationImage.attr("src", photo);
                        // destinationImage.attr("style", "height: 250px; width:250px;")

                        console.log(resp2);
                        console.log(resp2.childNodes[0].nodeValue);
                        console.log(resp2.getElementsByTagName("name")[0].childNodes[0].nodeValue);
                        console.log(resp2.getElementsByTagName("venue_name")[0].childNodes[0].nodeValue);
                        console.log(resp2.getElementsByTagName("venue_address")[0].childNodes[0].nodeValue);
                        console.log(resp2.getElementsByTagName("city_name")[0].childNodes[0].nodeValue);
                        console.log(resp2.getElementsByTagName("country_name")[0].childNodes[0].nodeValue);
                        console.log(resp2.getElementsByTagName("start_time")[0].childNodes[0].nodeValue);
                        // console.log(resp2.getElementsByTagName("stop_time")[0].childNodes[0].nodeValue);

                        document.getElementById("event_name").innerHTML =
                            resp2.getElementsByTagName("name")[0].childNodes[0].nodeValue;

                        document.getElementById("event_name2").innerHTML = "Perfomer: " +
                            resp2.getElementsByTagName("name")[0].childNodes[0].nodeValue;

                        document.getElementById("venue_name").innerHTML = "Venue: " +
                            resp2.getElementsByTagName("venue_name")[0].childNodes[0].nodeValue;

                        document.getElementById("venue_address").innerHTML = "Venue Address: " +
                            resp2.getElementsByTagName("venue_address")[0].childNodes[0].nodeValue + " " + resp2.getElementsByTagName("city_name")[0].childNodes[0].nodeValue + ", " + resp2.getElementsByTagName("country_name")[0].childNodes[0].nodeValue;;

                        document.getElementById("start_time").innerHTML = "Date & Time: " +
                            resp2.getElementsByTagName("start_time")[0].childNodes[0].nodeValue;
                    });
            });

            // this is the call for the carousel
            var thingToLookUp = $("#artist_name2").val().trim();
            var eventThing = $("#event_name2").val().trim();

            var queryURL3 = "https://rest.bandsintown.com/artists/" + thingToLookUp + "/events?app_id=codingbootcamp"

            $.ajax({
                url: queryURL3,
                method: "GET"
            }).then(function (resp3) {

                var results = resp3;
                console.log(results);
                // var countryLoc = results[1].venue.country;
                // console.log(countryLoc);
                var displayShows = [];
                for (shows in results) {
                    if (results[shows].venue.country === eventThing) {
                        displayShows.push(results[shows]);
                    }
                }
                console.log(displayShows);
                console.log(displayShows[1].offers[1].url);

                // for (items in displayShows) 
                for (var i = 0; i < displayShows.length; i++) {
                    // console.log(displayShows[i]);
                    var artistDiv = $("<div>").attr("class", "carousel-item");
                    var child1 = $("<div>").attr("class", "card col s12");
                    // console.log(child1);

                    var child2 = $("<div>").attr("class", "card-image waves-effect waves-block waves-light");
                    var artistImg = $("<img>").attr("class", "activator");
                    artistImg.attr("src", "https://images-na.ssl-images-amazon.com/images/I/81B1F0TMyBL._SY355_.jpg");
                    child2.append(artistImg);


                    var child3 = $("<div>").attr("class", "card-content");
                    var spanItem1 = $("<span>").attr("class", "card-title activator grey-text text-darken-4");
                    var imageContainer1 = $("<i>").text("more_vert").attr("class", "material-icons right");
                    spanItem1.append(imageContainer1);

                    var para1 = $("<p>").append("<a href='" + displayShows[i].offers[0].url + "'>Checkout Tickets</a>");
                    var para2 = $("<p>").append("<a href='" + displayShows[i].offers[1].url + "'>Checkout VIP Tickets</a>");
                    // var link1 = $("<a>").text("Checkout Tickets").attr("href", displayShows[items].offers[1].url);
                    // var link2 = $("<a>").text("Checkout VIP Tickets").attr("href", displayShows[items].offers[2].url);
                    child3.append(spanItem1);
                    child3.append(para1);
                    child3.append(para2);

                    var child4 = $("<div>").attr("class", "card-reveal");
                    var spanItem2 = $("<span>").attr("class", "card-title grey-text text-darken-4");
                    var imageContainer2 = $("<i>").text("close").attr("class", "material-icons right");
                    spanItem2.append(imageContainer2);
                    var venueForArtist = $("<p>").text("Venue: " + displayShows[i].venue.name);
                    // address is in long / lat - need to convet
                    // var venueAddressForArtist = $("<p>").text("Address " + displayShows[i].venue.address);
                    var locationForArtist = $("<p>").text("City: " + displayShows[i].venue.city + ", " + displayShows[i].venue.country);
                    var timeOfPerformance = $("<p>").text("Time: " + displayShows[i].datetime);
                    child4.append(spanItem2);
                    child4.append(venueForArtist);
                    child4.append(locationForArtist);
                    child4.append(timeOfPerformance);

                    child1.append(child2);
                    child1.append(child3);
                    child1.append(child4);

                    // console.log(child1);
                    artistDiv.append(child1);
                    console.log(artistDiv);
                    $("#add-artists").append(artistDiv);
                }


            });
        });
    });
</script>